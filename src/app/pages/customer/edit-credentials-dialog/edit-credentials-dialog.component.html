<div class="credentials-dialog">
  <h2 mat-dialog-title class="dialog-title">
    <mat-icon class="title-icon">lock</mat-icon>
    <span>Security & Login Settings</span>
  </h2>

  <mat-dialog-content class="dialog-content">
    <mat-tab-group class="credentials-tabs" animationDuration="300ms">
      <!-- Email Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">alternate_email</mat-icon>
          Email Address
        </ng-template>

        <div class="tab-content">
          <div class="info-banner">
            <mat-icon>info</mat-icon>
            <div>
              <strong>Email is your login ID</strong>
              <p>Changing your email will update your login credentials. Make sure you remember the new email.</p>
            </div>
          </div>

          <form [formGroup]="emailForm" class="credential-form">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Email Address</mat-label>
              <mat-icon matPrefix>alternate_email</mat-icon>
              <input matInput formControlName="email" type="email" required>
              @if (emailForm.get('email')?.hasError('required')) {
                <mat-error>Email is required</mat-error>
              }
              @if (emailForm.get('email')?.hasError('email')) {
                <mat-error>Please enter a valid email address</mat-error>
              }
            </mat-form-field>

            @if (error() && emailForm.dirty) {
              <div class="error-message">
                <mat-icon>error_outline</mat-icon>
                <span>{{ error() }}</span>
              </div>
            }

            <div class="tab-actions">
              <button mat-stroked-button type="button" (click)="onCancel()" [disabled]="loading()">
                <mat-icon>close</mat-icon>
                Cancel
              </button>
              <button mat-raised-button color="primary" type="button"
                      (click)="onUpdateEmail()"
                      [disabled]="emailForm.invalid || loading() || emailForm.pristine">
                @if (loading()) {
                  <mat-spinner diameter="20"></mat-spinner>
                } @else {
                  <mat-icon>check_circle</mat-icon>
                }
                Update Email
              </button>
            </div>
          </form>
        </div>
      </mat-tab>

      <!-- Password Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">vpn_key</mat-icon>
          Password
        </ng-template>

        <div class="tab-content">
          <div class="info-banner">
            <mat-icon>security</mat-icon>
            <div>
              <strong>Keep your account secure</strong>
              <p>Use a strong password with at least 8 characters, including uppercase, lowercase, numbers, and special characters.</p>
            </div>
          </div>

          <form [formGroup]="passwordForm" class="credential-form">
            <!-- Current Password -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Current Password</mat-label>
              <mat-icon matPrefix>lock_outline</mat-icon>
              <input matInput formControlName="currentPassword"
                     [type]="hideCurrentPassword() ? 'password' : 'text'" required>
              <button mat-icon-button matSuffix (click)="hideCurrentPassword.set(!hideCurrentPassword())"
                      type="button" [attr.aria-label]="'Hide password'">
                <mat-icon>{{hideCurrentPassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              @if (passwordForm.get('currentPassword')?.hasError('required')) {
                <mat-error>Current password is required</mat-error>
              }
            </mat-form-field>

            <!-- New Password -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>New Password</mat-label>
              <mat-icon matPrefix>vpn_key</mat-icon>
              <input matInput formControlName="newPassword"
                     [type]="hideNewPassword() ? 'password' : 'text'" required>
              <button mat-icon-button matSuffix (click)="hideNewPassword.set(!hideNewPassword())"
                      type="button" [attr.aria-label]="'Hide password'">
                <mat-icon>{{hideNewPassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              @if (passwordForm.get('newPassword')?.hasError('required')) {
                <mat-error>New password is required</mat-error>
              }
              @if (passwordForm.get('newPassword')?.hasError('pattern')) {
                <mat-error>{{ getPasswordErrorMessage() }}</mat-error>
              }
            </mat-form-field>

            <!-- Confirm Password -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Confirm New Password</mat-label>
              <mat-icon matPrefix>check_circle</mat-icon>
              <input matInput formControlName="confirmPassword"
                     [type]="hideConfirmPassword() ? 'password' : 'text'" required>
              <button mat-icon-button matSuffix (click)="hideConfirmPassword.set(!hideConfirmPassword())"
                      type="button" [attr.aria-label]="'Hide password'">
                <mat-icon>{{hideConfirmPassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              @if (passwordForm.get('confirmPassword')?.hasError('required')) {
                <mat-error>Please confirm your password</mat-error>
              }
              @if (passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched) {
                <mat-error>Passwords do not match</mat-error>
              }
            </mat-form-field>

            @if (error() && passwordForm.dirty) {
              <div class="error-message">
                <mat-icon>error_outline</mat-icon>
                <span>{{ error() }}</span>
              </div>
            }

            <div class="tab-actions">
              <button mat-stroked-button type="button" (click)="onCancel()" [disabled]="loading()">
                <mat-icon>close</mat-icon>
                Cancel
              </button>
              <button mat-raised-button color="primary" type="button"
                      (click)="onUpdatePassword()"
                      [disabled]="passwordForm.invalid || loading()">
                @if (loading()) {
                  <mat-spinner diameter="20"></mat-spinner>
                } @else {
                  <mat-icon>check_circle</mat-icon>
                }
                Update Password
              </button>
            </div>
          </form>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>
</div>
