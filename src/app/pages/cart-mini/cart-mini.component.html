<div *ngIf="cartOpen" class="mini-cart-backdrop" (click)="closeCart()"></div>

<div *ngIf="cartOpen" class="mini-cart-container" [@slideIn] appClickOutside (clickOutside)="closeCart()">
  <!-- Cart Header -->
  <div class="cart-header">
    <div class="header-title">
      <mat-icon>shopping_cart</mat-icon>
      <h3>Shopping Cart</h3>
      <span class="item-count" *ngIf="(cartItems$ | async)?.length">{{ (cartItems$ | async)?.length }}</span>
    </div>
    <button mat-icon-button (click)="closeCart()" class="close-button" aria-label="Close cart">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Empty Cart State -->
  <div *ngIf="(cartItems$ | async)?.length === 0" class="empty-cart">
    <mat-icon class="empty-icon">shopping_cart</mat-icon>
    <h4>Your cart is empty</h4>
    <p>Add some products to get started!</p>
    <button mat-raised-button color="primary" [routerLink]="['/items']" (click)="closeCart()">
      <mat-icon>storefront</mat-icon>
      Shop Now
    </button>
  </div>

  <!-- Cart Items -->
  <div *ngIf="(cartItems$ | async)?.length! > 0" class="cart-content">
    <div class="cart-items-list">
      <app-cart-item-card
        *ngFor="let cartItem of (cartItems$ | async); trackBy: trackByItemId"
        [cartItem]="cartItem"
        [compact]="true"
        [showTotalPrice]="true"
        (quantityIncrease)="onQuantityIncrease($event)"
        (quantityDecrease)="onQuantityDecrease($event)"
        (itemRemove)="removeItem($event)">
      </app-cart-item-card>
    </div>

    <!-- Cart Footer -->
    <div class="cart-footer">
      <div class="subtotal-section">
        <div class="subtotal-row">
          <span>Subtotal</span>
          <span class="subtotal-amount">{{ totalPrice$ | async | currency }}</span>
        </div>
        <p class="tax-note">Shipping and taxes calculated at checkout</p>
      </div>

      <div class="action-buttons">
        <button mat-stroked-button color="primary" [routerLink]="['/items']" (click)="closeCart()" class="continue-btn">
          <mat-icon>arrow_back</mat-icon>
          Continue Shopping
        </button>
        <button mat-raised-button color="primary" [routerLink]="['/checkout']" (click)="closeCart()" class="checkout-btn">
          <mat-icon>payment</mat-icon>
          Checkout
        </button>
      </div>
    </div>
  </div>
</div>
