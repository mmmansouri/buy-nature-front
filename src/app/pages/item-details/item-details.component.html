<div class="item-details-container">
  <!-- Breadcrumb Navigation -->
  <div class="breadcrumb">
    <button mat-button (click)="goBack()" class="back-btn">
      <mat-icon>arrow_back</mat-icon>
      Back to Products
    </button>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading product details...</p>
    </div>
  }

  <!-- Error State -->
  @else if (error()) {
    <div class="error-container">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <h2>Product Not Found</h2>
      <p>{{ error() }}</p>
      <div class="error-actions">
        <button mat-raised-button color="primary" (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
          Back to Products
        </button>
        <button mat-stroked-button (click)="loadItem(route.snapshot.paramMap.get('id')!)">
          <mat-icon>refresh</mat-icon>
          Try Again
        </button>
      </div>
    </div>
  }

  <!-- Product Details - Responsive Layout -->
  @else if (item()) {
    <div class="product-details" [class.mobile-layout]="isMobile()">

      <!-- Desktop/Tablet Layout -->
      @if (!isMobile()) {
        <div class="desktop-layout">
          <!-- Left Column: Image + Description (Separate Cards) -->
          <div class="left-column">
            <!-- Image Gallery Card -->
            <mat-card class="gallery-card">
              <div class="main-image-container">
                @if (getSelectedImage()) {
                  <img
                    [src]="getSelectedImage()"
                    [alt]="item()!.name"
                    class="main-image">
                } @else {
                  <div class="image-placeholder">
                    <mat-icon>image</mat-icon>
                  </div>
                }

                <!-- Navigation Arrows -->
                @if (images().length > 1) {
                  <button
                    mat-icon-button
                    class="nav-arrow nav-prev"
                    (click)="previousImage()"
                    aria-label="Previous image">
                    <mat-icon>chevron_left</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    class="nav-arrow nav-next"
                    (click)="nextImage()"
                    aria-label="Next image">
                    <mat-icon>chevron_right</mat-icon>
                  </button>
                }
              </div>

              <!-- Thumbnail Navigation -->
              @if (images().length > 1) {
                <div class="thumbnail-navigation">
                  @for (img of images(); track $index) {
                    <div
                      class="thumbnail"
                      [class.active]="selectedImageIndex() === $index"
                      (click)="selectImage($index)">
                      <img [src]="img" [alt]="item()!.name + ' - Image ' + ($index + 1)">
                    </div>
                  }
                </div>
              }
            </mat-card>

            <!-- Description Card with Tabs -->
            <mat-card class="description-card">
              <mat-card-content>
                <mat-tab-group class="product-tabs" animationDuration="300ms">

                  <!-- Description Tab -->
                  <mat-tab>
                    <ng-template mat-tab-label>
                      <mat-icon class="tab-icon">description</mat-icon>
                      <span class="tab-label">Description</span>
                    </ng-template>
                    <div class="tab-content">
                      <p class="description-text">{{ item()!.description }}</p>

                      <mat-divider class="section-divider"></mat-divider>

                      <div class="additional-info">
                        <h4 class="info-title">
                          <mat-icon>info</mat-icon>
                          Why Choose This Product?
                        </h4>
                        <ul class="info-list">
                          <li><mat-icon>check</mat-icon>Sustainably sourced ingredients</li>
                          <li><mat-icon>check</mat-icon>No harmful chemicals or additives</li>
                          <li><mat-icon>check</mat-icon>Environmentally friendly packaging</li>
                          <li><mat-icon>check</mat-icon>Supports local organic farmers</li>
                        </ul>
                      </div>
                    </div>
                  </mat-tab>

                  <!-- Characteristics Tab -->
                  <mat-tab>
                    <ng-template mat-tab-label>
                      <mat-icon class="tab-icon">tune</mat-icon>
                      <span class="tab-label">Characteristics</span>
                    </ng-template>
                    <div class="tab-content">
                      <div class="characteristics-grid">
                        <div class="characteristic-item">
                          <span class="char-label">Weight</span>
                          <span class="char-value">500g</span>
                        </div>
                        <div class="characteristic-item">
                          <span class="char-label">Origin</span>
                          <span class="char-value">Local Farms</span>
                        </div>
                        <div class="characteristic-item">
                          <span class="char-label">Shelf Life</span>
                          <span class="char-value">12 months</span>
                        </div>
                        <div class="characteristic-item">
                          <span class="char-label">Storage</span>
                          <span class="char-value">Cool, dry place</span>
                        </div>
                        <div class="characteristic-item">
                          <span class="char-label">Category</span>
                          <span class="char-value">Organic Food</span>
                        </div>
                        <div class="characteristic-item">
                          <span class="char-label">Brand</span>
                          <span class="char-value">Buy Nature</span>
                        </div>
                      </div>
                    </div>
                  </mat-tab>

                  <!-- Certifications Tab -->
                  <mat-tab>
                    <ng-template mat-tab-label>
                      <mat-icon class="tab-icon">verified</mat-icon>
                      <span class="tab-label">Certifications</span>
                    </ng-template>
                    <div class="tab-content">
                      <div class="certifications-list">
                        <div class="certification-item">
                          <div class="cert-icon">
                            <mat-icon>eco</mat-icon>
                          </div>
                          <div class="cert-details">
                            <h4>USDA Organic</h4>
                            <p>Certified organic by the United States Department of Agriculture</p>
                          </div>
                        </div>

                        <div class="certification-item">
                          <div class="cert-icon">
                            <mat-icon>agriculture</mat-icon>
                          </div>
                          <div class="cert-details">
                            <h4>Non-GMO Project Verified</h4>
                            <p>Products made without genetically modified organisms</p>
                          </div>
                        </div>

                        <div class="certification-item">
                          <div class="cert-icon">
                            <mat-icon>nature_people</mat-icon>
                          </div>
                          <div class="cert-details">
                            <h4>Fair Trade Certified</h4>
                            <p>Supports fair wages and sustainable farming practices</p>
                          </div>
                        </div>

                        <div class="certification-item">
                          <div class="cert-icon">
                            <mat-icon>recycling</mat-icon>
                          </div>
                          <div class="cert-details">
                            <h4>100% Recyclable Packaging</h4>
                            <p>Environmentally friendly and fully recyclable materials</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </mat-tab>

                </mat-tab-group>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Right Column: Buy and Checkout -->
          <div class="right-column">
            <mat-card class="checkout-card">
              <mat-card-content>
                <!-- Product Title -->
                <h1 class="product-name">{{ item()!.name }}</h1>

                <!-- Stock Status -->
                <div class="stock-status">
                  @if (isInStock()) {
                    <mat-chip class="in-stock">
                      <mat-icon>check_circle</mat-icon>
                      In Stock
                    </mat-chip>
                  } @else {
                    <mat-chip class="out-of-stock">
                      <mat-icon>cancel</mat-icon>
                      Out of Stock
                    </mat-chip>
                  }
                </div>

                <mat-divider class="section-divider"></mat-divider>

                <!-- Price -->
                <div class="price-section">
                  <span class="price-label">Price</span>
                  <span class="price">{{ formatPrice(item()!.price) }}</span>
                </div>

                <!-- Quantity Selector -->
                <div class="quantity-section">
                  <mat-form-field appearance="outline" class="quantity-field">
                    <mat-label>Quantity</mat-label>
                    <mat-select [(ngModel)]="quantity">
                      @for (qty of quantityOptions; track qty) {
                        <mat-option [value]="qty">{{ qty }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                  <button
                    mat-raised-button
                    color="primary"
                    class="add-to-cart-btn"
                    [disabled]="!isInStock()"
                    (click)="addToCart()">
                    <mat-icon>add_shopping_cart</mat-icon>
                    Add to Cart
                  </button>
                  <button
                    mat-raised-button
                    color="accent"
                    class="buy-now-btn"
                    [disabled]="!isInStock()"
                    (click)="buyNow()">
                    <mat-icon>flash_on</mat-icon>
                    Buy Now
                  </button>
                </div>

                <!-- Product Features -->
                <div class="features-section">
                  <div class="feature-item">
                    <mat-icon>local_shipping</mat-icon>
                    <span>Free Shipping</span>
                  </div>
                  <div class="feature-item">
                    <mat-icon>eco</mat-icon>
                    <span>100% Organic</span>
                  </div>
                  <div class="feature-item">
                    <mat-icon>autorenew</mat-icon>
                    <span>Easy Returns</span>
                  </div>
                  <div class="feature-item">
                    <mat-icon>verified_user</mat-icon>
                    <span>Secure Payment</span>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      }

      <!-- Mobile Layout: Vertical Stack -->
      @else {
        <div class="mobile-stack">
          <!-- Image Gallery -->
          <mat-card class="gallery-card">
            <div class="main-image-container">
              @if (getSelectedImage()) {
                <img
                  [src]="getSelectedImage()"
                  [alt]="item()!.name"
                  class="main-image">
              } @else {
                <div class="image-placeholder">
                  <mat-icon>image</mat-icon>
                </div>
              }

              @if (images().length > 1) {
                <button
                  mat-icon-button
                  class="nav-arrow nav-prev"
                  (click)="previousImage()">
                  <mat-icon>chevron_left</mat-icon>
                </button>
                <button
                  mat-icon-button
                  class="nav-arrow nav-next"
                  (click)="nextImage()">
                  <mat-icon>chevron_right</mat-icon>
                </button>
              }
            </div>

            @if (images().length > 1) {
              <div class="thumbnail-navigation">
                @for (img of images(); track $index) {
                  <div
                    class="thumbnail"
                    [class.active]="selectedImageIndex() === $index"
                    (click)="selectImage($index)">
                    <img [src]="img" [alt]="item()!.name">
                  </div>
                }
              </div>
            }
          </mat-card>

          <!-- Buy and Checkout Section -->
          <mat-card class="checkout-card">
            <mat-card-content>
              <h1 class="product-name">{{ item()!.name }}</h1>

              <div class="stock-status">
                @if (isInStock()) {
                  <mat-chip class="in-stock">
                    <mat-icon>check_circle</mat-icon>
                    In Stock
                  </mat-chip>
                } @else {
                  <mat-chip class="out-of-stock">
                    <mat-icon>cancel</mat-icon>
                    Out of Stock
                  </mat-chip>
                }
              </div>

              <div class="price-section">
                <span class="price-label">Price</span>
                <span class="price">{{ formatPrice(item()!.price) }}</span>
              </div>

              <div class="quantity-section">
                <mat-form-field appearance="outline" class="quantity-field">
                  <mat-label>Quantity</mat-label>
                  <mat-select [(ngModel)]="quantity">
                    @for (qty of quantityOptions; track qty) {
                      <mat-option [value]="qty">{{ qty }}</mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="action-buttons">
                <button
                  mat-raised-button
                  color="primary"
                  class="add-to-cart-btn"
                  [disabled]="!isInStock()"
                  (click)="addToCart()">
                  <mat-icon>add_shopping_cart</mat-icon>
                  Add to Cart
                </button>
                <button
                  mat-raised-button
                  color="accent"
                  class="buy-now-btn"
                  [disabled]="!isInStock()"
                  (click)="buyNow()">
                  <mat-icon>flash_on</mat-icon>
                  Buy Now
                </button>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Description Section -->
          <mat-card class="description-card">
            <mat-card-content>
              <h3 class="section-title">
                <mat-icon>description</mat-icon>
                Product Description
              </h3>
              <p class="description-text">{{ item()!.description }}</p>

              <mat-divider class="section-divider"></mat-divider>

              <div class="features-section">
                <div class="feature-item">
                  <mat-icon>local_shipping</mat-icon>
                  <span>Free Shipping</span>
                </div>
                <div class="feature-item">
                  <mat-icon>eco</mat-icon>
                  <span>100% Organic</span>
                </div>
                <div class="feature-item">
                  <mat-icon>autorenew</mat-icon>
                  <span>Easy Returns</span>
                </div>
                <div class="feature-item">
                  <mat-icon>verified_user</mat-icon>
                  <span>Secure Payment</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      }
    </div>
  }
</div>
